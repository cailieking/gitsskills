String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};var ExtraCharge=function(t){var i={};this.options=$.extend({},i,t),this.$ctn=this.options.$ctn,this.initData=this.options.initData,this.data=[],this.len=this.options.len||1,this.init()};ExtraCharge.prototype={init:function(){var t=this.getTpl(this.initData,!0);this.$ctn.append(t),this.initEvent()},initEvent:function(){this.show();var t=this,i=this.$ctn,e=[],n=i.find("ul").last(),a=n.find('select[name="extraCharge"]'),s="",r={},o=!1,l=0;a.change(function(i){if(r={},e=t.data,o=!1,s="",msg="",s=$(this).val(),l=$(this).parents(".extra-charge-item").data("index"),""===s)msg="请选择附加费名称",alert(msg);else for(var n in e)e[n].name===s?(msg="不能选择相同的附加费名称",o=!0,alert(msg)):e[n].name!==s&&e[n].index===l&&(o=!0,e[n].name=s);o||(r.name=s,r.index=l,e.push(r),t.data=e)}),n.find('input[name="gp20Num"],input[name="gp40Num"],input[name="hq40Num"],input[name="piecePrice"]').blur(function(i){msg=t.checkInputData($(i.target)),msg?alert(msg):msg||s||alert("请选择附加费类型")}),n.find('select[name="unit"]').change(function(t){var i=$(this).val(),e=n.find('input[name="piecePrice"]'),a=n.find(".box-type").find("input");"box"===i?(e.val(""),e.prop({disabled:!0}),a.prop({disabled:!1})):"piece"===i&&(a.val(""),e.prop({disabled:!1}),a.prop({disabled:!0}))}),n.parent(".extra-charge-item").next().on("click",$.proxy(t.btnClick,t))},getAllData:function(){var t=this.$ctn,i={},e={},n=[],a=t.find("ul");return a=a.filter(function(t,i){return $(i).find('select[name="extraCharge"]').length>0&&""!==$(i).find('select[name="extraCharge"]').val()}),a.length>0&&$.each(a,function(t,a){i={},e={},i.extraCharge=$(a).find('select[name="extraCharge"]').val(),i.unit=$(a).find('select[name="unit"]').val(),i.gp20Num=$(a).find('input[name="gp20Num"]').val().trim()?$(a).find('input[name="gp20Num"]').val().trim():"0",i.gp40Num=$(a).find('input[name="gp40Num"]').val().trim()?$(a).find('input[name="gp40Num"]').val().trim():"0",i.hq40Num=$(a).find('input[name="hq40Num"]').val().trim()?$(a).find('input[name="hq40Num"]').val().trim():"0",i.piecePrice=$(a).find('input[name="piecePrice"]').val().trim()?$(a).find('input[name="piecePrice"]').val().trim():"0",i.currency=$(a).find('select[name="currency"]').val(),i.together=i.extraCharge+"-"+i.unit+"-"+i.gp20Num+"-"+i.gp40Num+"-"+i.hq40Num+"-"+i.piecePrice+"-"+i.currency,e.key=i.extraCharge,e.value=i.together,n.push(e)}),n},"delete":function(t){var i="",e=this.data;if(t){var n=this.len;this.len=n-1,i=t.siblings().find('select[name="extraCharge"]').val(),i&&(e=$.grep(e,function(t,e){return t.name===i?!1:!0})),this.data=e,t.parent().find("select").unbind(),t.parent().find("input").unbind(),t.unbind(),t.parent().remove()}},append:function(t){var i=this.len;if(i>9)return void alert("附加费只能添加10个");this.len=i+1;var e=this.getTpl();this.$ctn.append(e),this.initEvent()},btnClick:function(t){var i=$(t.target).data("name");"add"===i?this.append($(t.target)):"delete"===i&&this["delete"]($(t.target))},show:function(){this.$ctn.find(".list-item").show()},checkInputData:function(t){var i=t.val().replace(/^\s+|\s+$ /g,""),e="",n=this.dataTemp;return"receiptPrice"===t.prop("name")?i&&!/^\d+\.?\d+$/g.test(i)?e="请输入数字":i&&(i=parseInt(i).toFixed(2),n.receiptPrice=i):i&&!/\d+/g.test(i)&&(e="请输入数字"),e},getTpl:function(t,i){this.len=t?t.length:this.len;var e=[];e=i?["add","添加"]:["delete","删除"];var n=['<div class="list-item" style="display:none;">','<div class="extra-charge-item">',"<ul>","<li>名称</li>","<li>单位</li>",'<li class="box-type">柜型</li>',"<li>单票</li>","<li>币种</li>","</ul>","</div>","</div>"],a=['<div class="list-item" style="display:none;">','<div class="extra-charge-item" data-index="'+this.len+'">',"<ul>","<li>",'<select name="extraCharge">','<option value="">请选择</option>','<option value="ACF">ACF</option>','<option value="AMS">AMS</option>','<option value="DOC">DOC</option>','<option value="EIR">EIR</option>','<option value="ISPS">ISPS</option>','<option value="ORC">ORC</option>','<option value="PSD">PSD</option>','<option value="SEAL">SEAL</option>','<option value="TLX">TLX</option>','<option value="WRS">WRS</option>',"</select>","</li>","<li>",'<select name="unit">','<option value="box" selected>箱</option>','<option value="piece">票</option>',"</select>","</li>",'<li class="box-type">',"<span>","<b>20'</b>",'<input type="text" name="gp20Num"/>',"</span>","<span>","<b>40'</b>",'<input type="text" name="gp40Num"/>',"</span>","<span>","<b>40H'</b>",'<input type="text" name="hq40Num"/>',"</span>","</li>","<li>",'<input type="text" name="piecePrice" disabled/>',"</li>","<li>",'<select name="currency">','<option value="CNY">CNY</option>','<option value="USD">USD</option>','<option value="EUR">EUR</option>','<option value="HKD">HKD</option>',"</select>","</li>","</ul>","</div>",'<a role="button" data-name="'+e[0]+'" class="item-btn">'+e[1]+"</a>","</div>"];return a=i?n.join("")+a.join(""):a.join("")}},String.prototype.trim=function(){return this.replace(/^\s+|\s+$/gim,"")};var tipsMapping={userName:"用户名不能为空",companyName:"公司不能为空",mobile:"联系电话不能为空",startPort:"起始港不能为空",endPort:"目的港不能为空",cargoName:"货物名称不能为空",cargoWeight:"毛重不能为空",cargoCube:"体积不能为空",cargoNums:"件数不能为空",endDate:"出货日不能为空",number:"箱型不能为空，可多填",cargoBoxType:"箱型不能为空",mobileFormatError:"手机格式错误",qqFormatError:"格式错误,只能为数字",cargoWeightFormatError:"格式错误,只能为数字",cargoCubeFormatError:"格式错误,只能为数字",cargoNumsFormatError:"格式错误,只能为数字"},validateFormWhenSubmit=function(t,i,e){var n="";if(t)return e||(t.find('input[name="userName"]').val().trim()||(n=tipsMapping.userName),t.find('input[name="companyName"]').val().trim()||(n=tipsMapping.companyName),t.find('input[name="mobile"]').val().trim()||(n=tipsMapping.mobile)),e&&(i.startPort.value.trim()||(n=tipsMapping.startPort),i.endPort.value.trim()||(n=tipsMapping.endPort),i.cargoName.value.trim()||(n=tipsMapping.cargoName),i.endDate.value.trim()||(n=tipsMapping.endDate),"Whole"===i.transType.value.trim()&&(i.box20GP.value||i.box40GP.value||i.box40HQ.value||(n=tipsMapping.cargoBoxType)),i.cargoWeight.value.trim()||(n=tipsMapping.cargoWeight),i.cargoCube.value.trim()||(n=tipsMapping.cargoCube),$(i.cargoNums).is(":hidden")&&$(i.cargoNums).val("0"),!i.cargoNums||i.cargoNums.value.trim()||$(i.cargoNums).is(":hidden")||(n=tipsMapping.cargoNums)),n},validateInputWhenChange=function(t){if(t){var i="",t=t,e=t.val().trim();switch(t[0].name){case"qq":/^\d{6,13}$/.test(e)||(i=tipsMapping.qqFormatError);break;case"mobile":/^1\d{10}$/.test(e)||(i=tipsMapping.mobileFormatError);break;case"cargoWeight":case"cargoCube":case"cargoNums":/^\d+(\.\d+)?$/.test(e)||(i=tipsMapping.cargoCubeFormatError)}return i}};!function(t){"use strict";var i=function(i,e){this.$element=t(i),this.options=t.extend({},t.fn.typeaheads.defaults,e),this.focusShow=this.options.focusShow||!1,this.matcher=this.options.matcher||this.matcher,this.sorter=this.options.sorter||this.sorter,this.highlighter=this.options.highlighter||this.highlighter,this.updater=this.options.updater||this.updater,this.source=this.options.source,this.$menu=t(this.options.menu),this.shown=!1,this.listen()};i.prototype={constructor:i,select:function(){var i=this.$menu.find(".active").data("value"),e=this.$menu.find(".active").data("label");return this.$element.val(this.updater(e)).change(),t("#"+this.input_id).val(i),this.hide()},updater:function(t){return t},show:function(i){var e=t.extend({},this.$element.position(),{height:this.$element[0].offsetHeight,addLeft:parseInt(this.$element.css("marginLeft").replace("px",""))});return this.$menu.insertAfter('input[name="startPort"]').css({top:e.top+e.height,left:e.left+e.addLeft}).show(),this.shown=!0,this.options.width?this.$menu.css({width:this.options.width+"px"}):i.isLongResult?this.$menu.css({width:this.$element.width()+i.countExceed}):this.$menu.css({width:this.$element.width()}),this},hide:function(i){var e=this.$menu.find(".active").data("value"),n=this.$menu.find(".active").data("label");return""===this.$element.val()&&(e="",n=""),i||this.$element.val(n),t("#"+this.input_id).val(e),this.$menu.hide(),this.shown=!1,this},lookup:function(i){var e;return this.query=this.$element.val(),!this.query&&!this.focusShow||this.query.length<this.options.minLength?this.shown?this.hide():this:(e=t.isFunction(this.source)?this.source(this.query,t.proxy(this.process,this)):this.source,e?this.process(e):this)},process:function(i){var e=this,n=null;return i=t.grep(i,function(t){return"object"!=typeof t&&(t={label:t,value:t}),t.value=t.value||t,t.label=t.label||t.value,e.matcher(t.label,t.title)}),i=this.sorter(i),i.length||(i=[{value:this.options.noneValue||"",label:this.options.noneLabel}]),this.items=i.length,n=this.checkLongResult(i.slice(0,this.options.items)),this.render(i.slice(0,this.options.items)).show(n)},matcher:function(t,i){var e=!1,t=t.toLowerCase().replace(/\s+/g,""),n=this.query.toLowerCase().replace(/\s+/g,""),i=i.toLowerCase().replace(/\s+/g,""),a=~t.indexOf(n);return!a&&i&&~i.indexOf(n)&&(a=~i.indexOf(n)),e=-1>=a?!0:!1},sorter:function(t){if(""===this.query)return t;var i=this;return t.sort(function(t,e){return t.label.toLowerCase().indexOf(i.query.toLowerCase())-e.label.toLowerCase().indexOf(i.query.toLowerCase())})},highlighter:function(t){return"<span>"+t+"</span>"},render:function(i){var e=this;return i=t(i).map(function(i,n){i=t(e.options.item);for(var a in n)i.attr("data-"+a,n[a]);return i.html(e.highlighter(n.label)+"<b>"+(n.title||"")+" </b>"),i[0]}),this.$menu.html(i),this},checkLongResult:function(t){var i={isLongResult:!1,countExceed:0},e=0;if(!t||t[0].label==this.options.noneLabel)return!1;for(var n in t)e=t[n].label.length+t[n].title.length-10,e>0&&(i.isLongResult=!0,i.countExceed=i.countExceed<=e?e:i.countExceed);return i.countExceed=8*i.countExceed,i},next:function(i){var e=this.$menu.find(".active").removeClass("active"),n=e.next();n.length||(n=t(this.$menu.find("li")[0])),n.addClass("active")},prev:function(t){var i=this.$menu.find(".active").removeClass("active"),e=i.prev();e.length||(e=this.$menu.find("li").last()),e.addClass("active")},element_click:function(){this.$element.val()===this.options.noneLabel&&this.$element.val("")},listen:function(){this.$element.on("focus",t.proxy(this.focus,this)).on("blur",t.proxy(this.blur,this)).on("keypress",t.proxy(this.keypress,this)).on("keyup",t.proxy(this.keyup,this)).on("click",t.proxy(this.element_click,this)),this.eventSupported("keydown")&&this.$element.on("keydown",t.proxy(this.keydown,this)),this.$menu.on("click",t.proxy(this.click,this)).on("mouseenter","li",t.proxy(this.mouseenter,this)).on("mouseleave","li",t.proxy(this.mouseleave,this))},eventSupported:function(t){var i=t in this.$element;return i||(this.$element.setAttribute(t,"return;"),i="function"==typeof this.$element[t]),i},move:function(t){if(this.shown){switch(t.keyCode){case 9:case 13:case 27:t.preventDefault();break;case 38:t.preventDefault(),this.prev();break;case 40:t.preventDefault(),this.next()}t.stopPropagation()}},keydown:function(i){this.suppressKeyPressRepeat=~t.inArray(i.keyCode,[40,38,9,13,27]),this.move(i)},keypress:function(t){this.suppressKeyPressRepeat||this.move(t)},keyup:function(i){switch(i.keyCode){case 40:case 38:var e=this.$menu.find(".active").data("value"),n=this.$menu.find(".active").data("label");this.$element.val(this.updater(n)).change(),t("#"+this.input_id).val(e);break;case 16:case 17:case 18:break;case 9:if(this.$menu.find("li").index(".active")>0)return;case 13:if(!this.shown)return;this.select();break;case 27:if(!this.shown)return;this.hide();break;default:this.shown=!0,this.lookup()}i.stopPropagation(),i.preventDefault()},focus:function(t){this.shown=!0,this.lookup(),this.focused=!0},blur:function(){this.focused=!1,!this.mousedover&&this.shown&&this.hide(!0)},click:function(t){t.stopPropagation(),t.preventDefault(),this.$element.next().remove(),this.select()},mouseenter:function(i){this.mousedover=!0,this.$menu.find(".active").removeClass("active"),t(i.currentTarget).addClass("active")},mouseleave:function(t){this.mousedover=!1,!this.focused&&this.shown&&this.hide()}};var e=t.fn.typeaheads;t.fn.typeaheads=function(e){return this.each(function(){var n=t(this),a=n.data("typeaheads"),s="object"==typeof e&&e;a||n.data("typeaheads",a=new i(this,s)),"string"==typeof e&&a[e]()})},t.fn.typeaheads.defaults={noneLabel:"没有找到对应的港口",source:[],items:8,menu:'<ul class="typeaheads ui-port-list" style="font-size:12px;position:absolute;margin-top:2px;"></ul>',item:"<li></li>",minLength:0,focusShow:!0},t.fn.typeaheads.Constructor=i,t.fn.typeaheads.noConflict=function(){return t.fn.typeaheads=e,this},t(document).on("focus.typeaheads.data-api",'[data-provide="typeaheads"]',function(i){var e=t(this);e.data("typeaheads")||e.typeaheads(e.data())})}(window.jQuery);var MessageBox=function(t){var i={width:700,height:220,modal:!0,hide:!1,buttons:[],draggable:!0,appendTo:"body",position:"center",title:null,open:null,close:null,beforeClose:null,dragStart:null,dragStop:null,open:null};this.options=$.extend({},i,t),this.options.$content=$(this.options.content),this.buttons=this.options.buttons,this.title=this.options.title,this.init()};MessageBox.prototype={init:function(){var t=this.options.appendTo,i=['<div class="popup-area" style="position:absolute;";>','<div class="popup-bg" style="width:100%;height:100%"></div>','<div class="ui-msg-widget">',"<div>",'<div class="delete"><span>X</span></div>','<div class="title"></div>',"</div>",'<div class="ui-msg-content">',"</div>",'<div class="function-area btn-area">',"</div>","</div>","</div>"].join("");this.$msg=$(i),this.setMsgBoxStyle(this.$msg),this.$msg.find(".title").html(this.options.title),this.$msg.find(".ui-msg-content").append(this.options.$content),this.bindBtn(),this.$msg.appendTo(t)},bindBtn:function(){var t=this,i=this.buttons;0===i.length&&t.$msg.find(".btn-area").remove();var e=t.$msg,n=Object.prototype.toString.call(i),a=e.find(".delete");if(0!==i.length&&"[object Array]"===n){var s=e.find(".btn-area");$.each(i,function(i,e){var n=e.text,a=e.cls,r=e.handler,o='<a href="javascript:void(0)" class="'+a+'">'+n+"</a>";s.append(o),s.find("."+a).click(function(){r.call(t)})})}a.on("click",$.proxy(t.close,t))},setMsgBoxStyle:function(t){this.options.evt;t.css({top:0,width:"100%",height:$("body").height()});var i=t.find(".ui-msg-widget");i.css({zIndex:3e3,background:"#ffe",position:"fixed",width:this.options.width,height:this.options.height,left:($(window).width()-this.options.width)/2,top:($(window).height()-this.options.height)/2}),this.$msg=t},show:function(){this.$msg.show()},open:function(){},close:function(){this.$msg.hide()},alert:function(){},confirm:function(){},prompt:function(){},customisedDialog:function(){}},window.Msg=MessageBox;var getUrlParam=function(t){var i="";t?(i=t.split("?"),i.length>1&&(i="?"+i[1])):i=location.search;var e={};if(i)return i.indexOf("redirect_uri")&&(i=i.split("redirect_uri")[0]),i=i.replace(/\?/,"&").split("&"),$.each(i,function(t,i){var i=i;i&&(i=i.split("="),e[i[0]]=i[1])}),e},checkInput=function(t){if(t){var i="",e=t.prop("name"),n=t.val();if(-1!==e.toLowerCase().indexOf("email")&&n&&!/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/g.test(n)&&(i="邮箱格式错误"),-1!==e.toLowerCase().indexOf("phone")){var a=/^(\d{3,4}\-)?\d{7,8}$/i,s=/\d{11}/.test(n)||a.test(n);n&&!s&&(i="格式错误，手机号码必须为数字")}return i}},isEmptyInput=function(t){var i="";return t.bookingName.value.trim()?t.bookingContact.value.trim()?t.bookingEmail.value.trim()?(i=checkInput($(t.bookingEmail)))?i:t.bookingPhone.value.trim()?(i=checkInput($(t.bookingPhone)))?i:t.etd.value.trim()?t.placeReceipt.value.trim()?t.placeDelivery.value.trim()?t.gp20Num.value.trim()||t.gp40Num.value.trim()||t.hq40Num.value.trim()?t.gp20Num.value.trim()&&!t.gp20Quantity.value.trim()?i="20GP集装箱数量不能为空":t.gp40Num.value.trim()&&!t.gp40Quantity.value.trim()?i="40GP集装箱数量不能为空":t.hq40Num.value.trim()&&!t.hq40Quantity.value.trim()?i="40HP集装箱数量不能为空":t.commodity.value.trim()?i:i="货品描述不能为空":i="集装箱包装件数不能为空":i="目的地不能为空":i="装货地不能为空":i="开船时间不能为空":i="订舱人TEl不能为空":i="订舱人Email不能为空":i="订舱人Contact不能为空":i="订舱人Name不能为空"},queryParams=getUrlParam(),isTrue=queryParams&&queryParams.verify;!isTrue||isTrue&&"false"===isTrue?$(".gp20Vip,.gp40Vip,.hq40Vip").html("优惠价"):$(".gp20Vip,.gp40Vip,.hq40Vip").each(function(){var t=$(this);t.html().trim().substring(1)||t.html("优惠价")}),$(".gp20,.gp40,.hq40").each(function(){var t=$(this);t.html().trim().substring(1)||t.html("--")});var $shipStartDate=$('input[name="etd"]');$shipStartDate.datepicker(),$shipStartDate.change(function(t){var i=$(this);i&&!i.val()&&alert("开船日期不能为空")});var checkNumsOfBoxType=function(t){if(t){var i="",e="",n=t.parents("tr").data("name"),a=t.prop("name");return"gp20Num"!==a&&"gp40Num"!==a&&"hq40Num"!==a&&(e=t.parents("tr").find('input[name="'+n+'Num"]').val()),e||(i=n+"件数不能为空"),i}};$('input[name="gp20Num"],input[name="gp40Num"],input[name="hq40Num"]').focus(function(t){}).blur(function(t){$(this).val()&&!/\d+/g.test($(this).val())&&(alert("格式错误，请输入数字"),$(this).val(""))}),$('input[name="gp20Quantity"],input[name="gp40Quantity"],input[name="hq40Quantity"]').focus(function(t){var i=checkNumsOfBoxType($(this));return i?void alert(i):void 0}).blur(function(){}),$('input[name="gp20Volume"],input[name="gp40Volume"],input[name="hq40Volume"]').focus(function(t){var i=checkNumsOfBoxType($(this));return i?void alert(i):void 0}).blur(function(t){$(this).val()&&!/\d+/g.test($(this).val())&&(alert("格式错误，请输入数字"),$(this).val(""))}),$('input[name="gp20Weight"],input[name="gp40Weight"],input[name="hq40Weight"]').focus(function(t){var i=checkNumsOfBoxType($(this));return i?void alert(i):void 0}).blur(function(){$(this).val()&&!/\d+/g.test($(this).val())&&(alert("格式错误，请输入数字"),$(this).val(""))}),$('input[name="bookingEmail"],input[name="shipperEmail"],input[name="consigneeEmail"],input[name="notifyPartyEmail"],input[name="charge_email"]').focus(function(t){}).blur(function(t){var i=checkInput($(this));return i?void alert(i):void 0}),$('input[name="bookingPhone"],input[name="shipperPhone"],input[name="consigneeEmail"],input[name="notifyPartyEmail"],input[name="charge_email"]').focus(function(t){}).blur(function(t){var i=checkInput($(this));return i?void alert(i):void 0}),$("#booking_ensure").click(function(t){var i=$('input[name="agree"]'),e=0,n="",a={};a.startPort=$(".start-port").html().trim(),a.endPort=$(".end-port").html().trim(),a.expireDate=$(".expire-date").html().replace(/\s+/gm,""),a.shipCompany=$(".shippingCmp").html().trim(),e=$("#gp20Nums").val(),e?n=e+"*20GP ":"",e=$("#gp40Nums").val(),e?n+=e+"*40GP ":"",e=$("#hq40Nums").val(),e?n+=e+"*40HQ":"",a.boxType=n;var s='<ul class="booking_info"><li><span>起始港</span><span class="key_val">'+a.startPort+'</span></li><li><span>目的港</span><span class="key_val">'+a.endPort+'</span></li><li><span>船公司</span><span class="key_val">'+a.shipCompany+'</span></li><li style="width:300px;margin-right:10px;"><span>箱型</span><span class="key_val">'+a.boxType+'</span></li><li style="width:250px;"><span>有效期</span><span class="key_val">'+a.expireDate+"</span></li></ul";if(i.prop("checked")){var r=isEmptyInput($('form[name="form_booking_online"]')[0]);if(r)return void alert(r);new MessageBox({title:"确认订单",evt:t,content:s,buttons:[{text:"确认",cls:"ensure",handler:function(){this.close(),$('form[name="form_booking_online"]').submit()}},{text:"取消",cls:"ensure",handler:function(){this.close()}}]})}else new MessageBox({title:"温馨提示",evt:t,content:'<div class="dialog_bookingOnline">请接受找船网在线订舱协议!</div>'})}),$("#bookingOnline").click(function(t){var i=$(".booking-online-ctn"),e=$(".registrant-inf"),n=$(".shipping-inf");i.is(":hidden")&&(e.hide(),n.css({height:"2330px"}),i.show())}),$("#inquiryOnline").click(function(t){var i=$(".booking-online-ctn"),e=$(".registrant-inf"),n=$(".shipping-inf");e.is(":hidden")&&(i.hide(),n.css({height:"1250px"}),e.show())}),$("#gp20Nums,#gp40Nums,#hq40Nums").blur(function(){var t=/^(-)?\d+$/gim,i=$(".gp20").html()&&t.test(parseInt($(".gp20").html().trim().substring(1)))?$(".gp20").html().trim().substring(1):"0",e=($(".gp20Vip").html()&&NaN!=parseInt($(".gp20Vip").html().trim().substring(1))?$(".gp20Vip").html().trim().substring(1):"0",$(".gp40").html()&&/^(-)?\d+$/gim.test(parseInt($(".gp40").html().trim().substring(1)))?$(".gp40").html().trim().substring(1):"0"),n=($(".gp40Vip").html()&&NaN!=parseInt($(".gp40Vip").html().trim().substring(1))?$(".gp40Vip").html().trim().substring(1):"0",$(".hq40").html()&&/^(-)?\d+$/gim.test(parseInt($(".hq40").html().trim().substring(1)))?$(".hq40").html().trim().substring(1):"0"),a=($(".hq40Vip").html()&&NaN!=parseInt($(".hq40Vip").html().trim().substring(1))?$(".hq40Vip").html().trim().substring(1):"0",0),s=0,r=0,o=$('input[name="isVip"]').prop("checked");o?(a=i,s=e,r=n):(a=$(".gp20Vip").html()&&t.test(parseInt($(".gp20Vip").html().trim().substring(1)))?$(".gp20Vip").html().trim().substring(1):i,s=$(".gp40Vip").html()&&t.test(parseInt($(".gp40Vip").html().trim().substring(1)))?$(".gp40Vip").html().trim().substring(1):e,r=$(".hq40Vip").html()&&t.test(parseInt($(".hq40Vip").html().trim().substring(1)))?$(".hq40Vip").html().trim().substring(1):n);var l=$("#gp20Nums"),p=$("#gp40Nums"),h=$("#hq40Nums"),u=$("#of_money"),c=$("#money"),m=$("#gp20Nums").val()?parseInt(a)*parseInt(l.val().trim()):"0",d=$("#gp40Nums").val()?parseInt(s)*parseInt(p.val().trim()):"0",g=$("#hq40Nums").val()?parseInt(r)*parseInt(h.val().trim()):"0";sumTotal=parseInt(m)+parseInt(d)+parseInt(g),u.val(sumTotal).css("color","red");var v=$("#gp20Nums").val()?$("#gp20Nums").val().trim():"0",f=$("#gp40Nums").val()?$("#gp40Nums").val().trim():"0",b=$("#hq40Nums").val()?$("#hq40Nums").val().trim():"0";$(".local_list").each(function(){var t=$(this).find('input[name="extraCharge"]').val().trim(),i=$(this).find('input[name="unit"]').val().trim(),e=$(this).find('input[name="gp20Num"]').val()?$(this).find('input[name="gp20Num"]').val().trim():"0",n=$(this).find('input[name="gp40Num"]').val()?$(this).find('input[name="gp40Num"]').val().trim():"0",a=$(this).find('input[name="hq40Num"]').val()?$(this).find('input[name="hq40Num"]').val().trim():"0",s=$(this).find('input[name="piecePrice"]').val()?$(this).find('input[name="piecePrice"]').val().trim():"0",r=0;"箱"===i?r=parseInt(e)*parseInt(v)+parseInt(n)*parseInt(f)+parseInt(a)*parseInt(b):"票"===i&&(r=s),$(".local_total").find('input[name="'+t+'"]').val(r).css({color:"red"})});var y=0,x=0,_=0,w=0;$(".local_charge_unit").each(function(){"CNY"===$(this).html().trim()?y+=parseInt($(this).parent().find(".total").val().trim()):"USD"===$(this).html().trim()?x+=parseInt($(this).parent().find(".total").val().trim()):"EUR"===$(this).html().trim()?_+=parseInt($(this).parent().find(".total").val().trim()):"HKD"===$(this).html().trim()&&(w+=parseInt($(this).parent().find(".total").val().trim()))});var k=0!=y?y+"CNY,":"",N=0!=x?x+"USD,":"",C=0!=_?_+"EUR,":"",P=0!=w?w+"HKD,":"",I=k+N+C+P,q=k+(x+sumTotal)+"USD"+C+P;$("#local_money").val(I).css({color:"red"}),c.html(q)});var locaLTotal=$(".locaL-total").val()?$(".locaL-total").val().trim():"",EXg=/^[A-Za-z]+\-[A-Za-z]+\-\d+\-\d+\-\d+\-\d+\-[A-Za-z]+/gim;if($(".locaL-total").val()&&EXg.test($(".locaL-total").val().trim())){var Arr=locaLTotal.split(";");if(Arr.length>0){$(".list-seven").css({height:35*(Arr.length+1)+"px"}),$("#shipping-inf").css({height:35*Arr.length+2300+"px"});for(var i=0;i<Arr.length;i++){var arrListMsg=Arr[i].split("-");arrMsg=$.map(arrListMsg,function(t){return"piece"===t?"票":"box"===t?"箱":"0"===t?"":t});var listMsg=['<ul class="local_list">','<li class="list_one">','<input type="text" name="extraCharge"  value="'+arrMsg[0]+'">',"</li>",'<li class="list_two">','<input type="text" name="unit" value="'+arrMsg[1]+'">',"</li>",'<li class="list_three">','<span style="margin-right:25px">',"<b >20GP</b>",'<input type="text" name="gp20Num" value="'+arrMsg[2]+'">',"</span>",'<span style="margin-right:25px">',"<b>40GP</b>",'<input type="text" name="gp40Num" value="'+arrMsg[3]+'">',"</span>","<span>","<b>40HQ</b>",'<input type="text" name="hq40Num" value="'+arrMsg[4]+'">',"</span>","</li>",'<li class="list_four">','<input type="text" name="piecePrice" value="'+arrMsg[5]+'">',"</li>",'<li class="list_five">','<input type="text" name="currency" value="'+arrMsg[6]+'" >',"</li>","</ul>"].join(""),showLocalMsg=['<li class="local_total_list">','<span class="title_name"  style="display:inline-block;*display:inline;*zoom:1;width:32px;text-align:center">',arrMsg[0],"</span>",'<input type="text"  class="total" name="',arrMsg[0],'">','<span class="local_charge_unit">',arrMsg[6],"</span>","</li>"].join("");$(".additional").append(listMsg),$(".local_total").append(showLocalMsg),$(".additional,.local_total_charge").find("input").prop("disabled",!0)}}}else $(".additional").html(locaLTotal).parent().css({height:"80px"}),$(".local_total_charge").html(locaLTotal).css({padding:"15px"});$('input[name="isVip"]').change(function(){$("#gp20Nums").blur()}),location.hash="";var anchorHash="";$('input[name="transType"]').change(function(){"Together"===$(this).val()?($("#piece").show(),$(".box-size").hide()):($("#piece").hide(),$(".box-size").show())}),$("#cargo-tabs").click(function(t){var i=location.hash,e=$(t.target),n="LI"===e[0].tagName||"LI"===e.parent()[0].tagName;n&&e.html().length>0&&(e="LI"===e[0].tagName?e:e.parent(),anchorHash=e.find("a").prop("href").match("#[a-z-]+$")[0],i!==anchorHash&&(tabStyle(e),location.href=e.find("a").prop("href").split("#")[0]+anchorHash,$(anchorHash).show(),$(anchorHash).siblings().hide())),t.stopPropagation(),t.preventDefault();var a=$(".tabs .active").find("a").html(),s=$("body").width()-$(".shipping-inf").width(),r=$(".list-first").width(),o=$(".list-second").width(),l=$(".list-third").width(),p=s/2+r+o+l/2;"货盘描述"==a?($(".shipping-inf").height(1250),$("iframe").eq(1).css({position:"relative",left:p+"px",top:"-640px"})):($(".shipping-inf").height(1820),$("iframe").eq(1).css({position:"relative",left:p+"px",top:"-1210px"}))});var tabStyle=function(t){t&&(t.siblings().filter(".active").removeClass("active"),t.addClass("active"))},limitHeight=function(t,i){if(t&&t.html()){var e=t.html();t.html(e.substring(0,i))}};$limitWeight=$(".limit-weight"),$additionalInfo=$(".additional-info"),limitHeight($limitWeight,50),limitHeight($additionalInfo,80);var showErrorMsg=function(t){var i="",e="";if(0!==t.parents(".registrant-inf").length&&!t.parents(".registrant-inf").is(":hidden"))if(t.val().trim())i=validateInputWhenChange(t),i&&(e='<span class="error-msg" style="color:red;font-size:12px;margin-left:15px;">'+i+"</span>",$(e).insertAfter(t));else{if("qq"===t.prop("name"))return;e='<span class="error-msg"  style="color:red;font-size:12px;margin-left:15px;">输入框内容不能为空</span>',$(e).insertAfter(t)}},inputArr=$(".registrant-inf").find('input[type="text"]');$.each(inputArr,function(t,i){var e="startPort"!==$(i).prop("name")&&"endPort"!==$(i).prop("name")&&"shipCompany"!==$(i).prop("name");e&&$(i).blur(function(){var t=$(i);showErrorMsg(t)}).focus(function(){var t=$(i);t.next()&&t.next().remove()})}),$("#shipping-inf").find('input[name="endDate"]').datepicker({yearRange:"2015:+11",onSelect:function(t,i){$(this).next().remove()}}),setTimeout(function(){$('input[name="startPort"]').typeaheads({source:start_port_list||window.start_port_list,items:8}),$('input[name="endPort"]').typeaheads({source:end_port_list||window.end_port_list,items:8})},3e3),$('input[name="shipCompany"]').focus(function(t){$("body").unbind("mousedown"),$("body").bind("mousedown",function(t){var i=$(".shipping-company-list"),e=$(t.target),n=e.hasClass("shipping-company-list")||e.parent().hasClass("shipping-company-list")||e.parent().parent().hasClass("shipping-company-list");i.is(":hidden")||n||i.hide(),t.stopPropagation()}),$(this).next(".error-msg").length>0&&$(this).next().remove();var i=$(this).next().show();i.animate({width:450,height:230},"slow")}).blur(function(t){}),$('input[name="shipCompany"]').parent().find(".shipping-company-list").click(function(t){var i=$(t.target);"LI"===i[0].tagName&&($('input[name="shipCompany"]').val(i.html().trim()),$(this).css({display:"none"}))}),$("textarea").focus(function(t){var i=$(t.target);("例如货盘信息，起始港 目的港等信息"===i.val().trim()||"请控制在150字以内"===i.val().trim())&&i.val("")});var queryParams=getUrlParam(),$shareInput=$("#common-input").find("input");$.each($shareInput,function(t,i){$(i).val(queryParams[$(i).prop("name")])});var setInputHiddenVal=function(t){var t=t,i=$("#common-input").find("input"),e={};return t.find('input[name="infoId"]').val(getUrlParam().infoId),$.each(i,function(i,n){var a=$(n).prop("name");e[a]=$(n).val().trim(),t.find('input[name="'+a+'"]').val($(n).val().trim())}),e.remark=$('textarea[name="remark"]').val().trim(),e.infoId=getUrlParam().infoId,e};$('a[name="inquiry"]').click(function(t){var i=validateFormWhenSubmit($("#common-input"),"",!1);if(i)return void window.alert(i);var e='<ul class="list"><li><b class="box"></b><span>点击<a href="javascript:void(0)">【确认】</a>将提交您的订舱咨询，并跳转至<a href="javascript:void(0)">【咨询管理】</a>可查看、管理您提交的相关内容；</span></li><li><b class="box"></b>点击<a href="javascript:void(0)">【确认并发布货盘】</a>将提交您的订舱咨询，并跳转至<a href="javascript:void(0)">【发布货盘】</a>，让更多的物流商给您报价；</li><li><b class="box"></b><span>点击<a href="javascript:void(0)">【返回】</a>将放弃本次订舱咨询，返回当前页面</span></li></ul>';new MessageBox({title:"",evt:t,content:e,buttons:[{text:"确认",cls:"active",handler:function(){this.close();var t=setInputHiddenVal($("#cargo-descript"));$.ajax({url:"../InqueryPrice/saveinquery",type:"get",dataType:"text",data:t,success:function(t){t&&16===t.length&&(location.href="../list.gsp")},error:function(t){16===t.responseText.length&&(location.href="../list.gsp")}})}},{text:"确认并发布货盘",cls:"green",handler:function(){this.close();var t=setInputHiddenVal($("#cargo-descript"));$.ajax({url:"../InqueryPrice/saveinquery",type:"get",dataType:"text",data:t,success:function(t){t&&16===t.length},error:function(t){16===t.responseText.length}}),$('a[href="#tab-create-cargo"]').click()}},{text:"返回",cls:"back-home",handler:function(){this.close()}}]})}),$('a[name="cargo-create"]').click(function(t){var i=validateFormWhenSubmit($("#common-input"),$("#create-cargo")[0],!0);if(i)return void window.alert(i);$("#create-cargo").find('input[name="infoId"]').val(getUrlParam().infoId);var e='<ul class="list"><li><b class="box"></b><span>点击<a>【确认】</a>将提交您的订舱咨询，并跳转至<a>【咨询管理】</a>可查看、管理您提交的相关内容；</span></li><li><b class="box"></b><span>点击 <a href="">【返回】</a>，将放弃本次订舱咨询，返回当前页面</span></li></ul>';new MessageBox({title:"",content:e,evt:t,buttons:[{text:"确认",cls:"active",handler:function(){this.close(),$("#tab-create-cargo").click(),$("#create-cargo").submit()}},{text:"返回",cls:"back-home",handler:function(){this.close()}}]})});var ec=new ExtraCharge({$ctn:$(".main-content")});$('input[name="startDate"],input[name="endDate"]').datepicker();var showErrorMsg=function(t){var i="",e="";t.val()?(i=validateInputWhenChange(t),i&&(e='<span class="error-msg">'+i+"</span>",$(e).insertAfter(t))):(e='<span class="error-msg"  style="color:red;font-size:12px;margin-left:15px;">输入框内容不能为空</span>',$(e).insertAfter(t))},route_style=$('input[name="route_style"]'),box_style=$('input[name="box_style"]');route_style.change(function(){"direact"===$(this).val().trim()?$(".middle_port").hide():$(".middle_port").show()}),box_style.change(function(){"Whole"===$(this).val().trim()?($(".together_style").hide(),$(".route_price").show()):($(".together_style").show(),$(".route_price").hide())}),$(".normal_price,.specical_prcie").blur(function(){$(this).val()&&!/^[1-9]+[0-9]*$/.test($(this).val().trim())&&alert("格式输入不对 请重新输入")}),$(".specical_prcie").blur(function(){$(this).val()&&!$(this).parent().siblings().find(".normal_price").val()?alert("填写优惠价前请填写普通价"):$(this).val()&&$(this).parent().siblings().find(".normal_price").val()&&parseInt($(this).parent().siblings().find(".normal_price").val().trim())<parseInt($(this).val().trim())&&alert("优惠价必须小于普通价")}),$(".shipping_date").eq(0).find(".num_box").blur(function(t){blurJudge(t.target)});var msg=['<div class="shipping_date">','<div  class="stopping_date">','<b  class="minus"></b>','<input type="text" class="num_box" name="">','<b class="addition"></b>','<span style="line-height:30px;margin-left:5px;">截</span>',"</div>",'<div  class="starting_date" style="margin-left:4px;">','<b  class="minus"></b>','<input type="text" class="num_box"  name="">','<b class="addition"></b>','<span style="line-height:30px;margin-left:5px;">开</span>',"</div>",'<div class="add_shipping_date">','<a href="javascript:void(0)" class="delete_shipping_btn" style="margin-left:5px"></a>',"</div>","</div>"].join("");
$(".shipping_date_area").click(function(t){var i=$(t.target);if(i.hasClass("minus")){var e=i.parent().find(".num_box"),n=e.val()?e.val().trim():"";if(n&&/\d+/.test(n)){var a=parseInt(n);a>1&&(a--,e.val(a))}}if(i.hasClass("addition")){var e=i.parent().find(".num_box"),n=e.val().trim();if(n){if(n&&/\d+/.test(n)){var a=parseInt(n);7>a?(a++,e.val(a)):a.val("7")}}else e.val("1")}i.hasClass("add_shipping_btn")&&$(".shipping_date").length<6&&($(".shipping_date_area").append(msg),$(".shipping_date_area").find(".shipping_date").last().find(".num_box").blur(function(t){blurJudge(t.target)})),i.hasClass("delete_shipping_btn")&&i.parent().parent().remove()});var blurJudge=function(t){var i=($(t).parent().siblings().find(".num_box"),!1);$(t).val()&&(/^[1-9]+$/.test($(t).val().trim())||alert("截关时间格式不对")),i&&alert("开船日和截船日必须同时注明")},validate=function(){var t=$('input[name="box_style"]:checked').val().trim();if("Whole"===t){var i=$('input[name="startPort"],input[name="endPort"],input[name="endPort"],input[name="endPort"],input[name="shippingDays"],input[name="shipCompany"],input[name="startDate"],input[name="endDate"]'),e=$(".num_box").length,n=$(".normal_price").length,a=0,s=0,r="";i.each(function(){$(this).val()||(r="必选项不能为空")});var o=$('input[name="shippingDays"]').val();o&&(/^\d+$/gim.test(o.trim())||(r="航程格式不对")),$(".num_box").each(function(){$(this).val()||a++,$(this).val()&&!/^[1-9]+$/.test($(this).val().trim())&&(r="船期格式不对"),$(this).val()&&!$(this).parent().siblings().find(".num_box").val()&&(r="船期里截船和开船日必须同时填写")}),$(".normal_price").each(function(){$(this).val()||s++}),$(".specical_prcie").each(function(){$(this).val()&&!/^[1-9]+[0-9]*$/.test($(this).val().trim())?r="运费格式不对":$(this).val()&&!$(this).parent().siblings().find(".normal_price").val()?r="填写优惠价前请填写普通价":$(this).val()&&$(this).parent().siblings().find(".normal_price").val()&&parseInt($(this).parent().siblings().find(".normal_price").val().trim())<parseInt($(this).val().trim())&&(r="优惠价必须小于普通价")}),a==e&&(r="船期不能全为空"),s==n&&(r="运价不能全为空");var l=[];$('select[name="extraCharge"]').each(function(){$(this).val()&&l.push($(this).val())});for(var p=l.sort(),s=0;s<p.length;s++)p[s]===p[s+1]&&(r="local费用名不能重复");if($('input[name="startDate"]').val()&&$('input[name="endDate"]').val()){var h=$('input[name="startDate"]').val().split("-").join(""),u=$('input[name="endDate"]').val().split("-").join("");h>=u&&(r="有效期开始日期不能大于截止日期")}return r}var c=$('input[name="startPort"],input[name="endPort"],input[name="endPort"],input[name="endPort"],input[name="shippingDays"],input[name="shipCompany"],input[name="startDate"],input[name="endDate"],input[name="per_price"],input[name="min_charge"]'),e=$(".num_box").length,a=0,r="";c.each(function(){$(this).val()||(r="必选项不能为空")});var o=$('input[name="shippingDays"]').val();o&&(/^\d+$/gim.test(o.trim())||(r="航程格式不对")),$(".num_box").each(function(){$(this).val()||a++,$(this).val()&&!/^[1-9]+$/.test($(this).val().trim())&&(r="船期格式不对"),$(this).val()&&!$(this).parent().siblings().find(".num_box").val()&&(r="船期里截船和开船日必须同时填写")}),a==e&&(r="船期不能全为空");var l=[];$('select[name="extraCharge"]').each(function(){$(this).val()&&l.push($(this).val())});for(var p=l.sort(),s=0;s<p.length;s++)p[s]===p[s+1]&&(r="local费用名不能重复");if($('input[name="startDate"]').val()&&$('input[name="endDate"]').val()){var h=$('input[name="startDate"]').val().split("-").join(""),u=$('input[name="endDate"]').val().split("-").join("");h>=u&&(r="有效期开始日期不能大于截止日期")}return r},getLocalMeg=function(){var t=[];$(".shipping_date").each(function(){if($(this).find(".num_box").val()){var i=$(this).find(".stopping_date").find(".num_box").val().trim(),e=$(this).find(".starting_date").find(".num_box").val().trim(),n=i+"截"+e+"开";t.push(n)}}),$('input[name="total_shipping_date"]').val(t.join(","));var i=ec.getAllData(),e=[];if(i.length>0){for(var n=0;n<i.length;n++)e.push(i[n].value);$('input[name="total_local_cost"]').val(e.join(";"))}};$(".make_sure").click(function(){var t=validate();t?alert(t):(getLocalMeg(),$("#myform").submit())}),$(".cancel").click(function(){$("#myform")[0].reset()}),$(".back").click(function(){window.location.href="http://"+window.location.host+"/member"}),$('input[name="shippingDays"],input[name="per_price"],input[name="min_charge"]').blur(function(){showErrorMsg($(this))}).focus(function(){$(this).next()&&$(this).next().remove()}),setTimeout(function(){$('input[name="startPort"]').typeaheads({source:start_port_list||window.start_port_list,items:8}),$('input[name="endPort"]').typeaheads({source:end_port_list||window.end_port_list,items:8}),$('input[name="middlePort"]').typeaheads({source:end_port_list||window.end_port_list,items:8})},3e3),$('input[name="shipCompany"]').focus(function(t){$("body").unbind("mousedown"),$("body").bind("mousedown",function(t){var i=$(".shipping-company-list"),e=$(t.target),n=e.hasClass("shipping-company-list")||e.parent().hasClass("shipping-company-list")||e.parent().parent().hasClass("shipping-company-list");i.is(":hidden")||n||i.hide(),t.stopPropagation()}),$(this).next(".error-msg").length>0&&$(this).next().remove();var i=$(this).next().show();i.animate({width:450,height:230},"slow"),$('input[name="shipCompany"]').parent().find(".shipping-company-list").click(function(t){var i=$(t.target);"LI"===i[0].tagName&&($('input[name="shipCompany"]').val(i.html().trim()),$(this).css({display:"none"}))})});